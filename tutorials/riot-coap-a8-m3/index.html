
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.iot-lab.info/tutorials/riot-coap-a8-m3/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:21:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<!-- [if IE]> <meta http-equiv="X-UA-Compatible" content="IE=Edge"/> <! [endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="../../xmlrpc.php" />
<title>CoAP server with public IPv6 and A8-M3 nodes &#8226; FIT/IoT-LAB</title>
<!--[if lt IE 9]><script src="https://www.iot-lab.info/wp-content/themes/alienship-1.2.5/js/html5shiv.js" type="text/javascript"></script><![endif]-->

<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Comments Feed" href="../../comments/feed/index.html" />
<link rel='stylesheet' id='responsive-lightbox-swipebox-front-css'  href='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/swipebox2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='toc-screen-css'  href='../../wp-content/plugins/table-of-contents-plus/screen6149.css?ver=1404' type='text/css' media='all' />
<link rel='stylesheet' id='parent-style-css'  href='../../wp-content/themes/alienship-1.2.5/style2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../../wp-content/themes/alienship-1.2.5/css/bootstrap.minb3e8.css?ver=0.1' type='text/css' media='all' />
<link rel='stylesheet' id='alienship-style-css'  href='../../wp-content/themes/alienship-1.2.5-child/styleb3e8.css?ver=0.1' type='text/css' media='all' />
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery90f9.js?ver=1.11.1'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/jquery.swipebox.min2f54.js?ver=4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var rlArgs = {"script":"swipebox","selector":"lightbox","custom_events":"","activeGalleries":"1","animation":"1","hideBars":"1","hideBarsDelay":"5000","videoMaxWidth":"1080"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/js/front2f54.js?ver=4.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5-child/js/bootstrap-hover-dropdown.min2f54.js?ver=4.1'></script>
<link rel='canonical' href='index.html' />
        <style type="text/css" media="screen">
          div.printfriendly {
            margin: 12px 12px 12px 12px;;
          }
          div.printfriendly a, div.printfriendly a:link, div.printfriendly a:visited {
            text-decoration: none;
            font-size: 14px;
            color: #6D9F00;
            vertical-align: bottom;
            border: none;
          }

          .printfriendly a:hover {
            cursor: pointer;
          }

          .printfriendly a img  {
            border: none;
            padding:0;
            margin-right: 6px;
            display:inline-block;
            box-shadow: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
          }
          .printfriendly a span{
            vertical-align: bottom;
          }
          .pf-alignleft {
            float: left;
          }
          .pf-alignright {
            float: right;
          }
          div.pf-aligncenter {
            display: block;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
          }
        </style>
        <style type="text/css" media="print">
          .printfriendly {
            display: none;
          }
        </style>
 	<style type="text/css">
 				#site-title,
		#site-description {
			position: absolute;
			clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
			clip: rect(1px, 1px, 1px, 1px);
		}
 		 	</style>
 	
<!-- BEGIN GADWP v5.3.1.1 Universal Analytics - https://deconf.com/google-analytics-dashboard-wordpress/ -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-115966924-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- END GADWP Universal Analytics -->
</head>

<body class="page page-id-5371 page-child parent-pageid-7210 page-template-default layout-1c">
	<!--[if lt IE 9]><p class="browsehappy alert alert-danger">You are using an outdated browser. Please <a class="alert-link" href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]-->

	<!-- Top Menu -->
	<nav class="navbar navbar-default navbar-onelab navbar-fixed-top top-navigation" role="navigation">
	    <div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
							<a href="../../index.html"><img src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-iotlab3.png" /></a>
					</div>

		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul id="menu-topmainmenu" class="nav navbar-nav"><li id="menu-item-2066" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2066"><a title="News" href="../../news/index.html">News</a></li>
<li id="menu-item-140" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-140 dropdown"><a title="Platform" data-toggle="dropdown" data-hover="dropdown" href="../../what-is-iot-lab/index.html">Platform <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-466" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-466"><a title="What is IoT-LAB?" href="../../what-is-iot-lab/index.html">What is IoT-LAB?</a></li>
	<li id="menu-item-147" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-147"><a title="Deployment" href="../../deployment/index.html">Deployment</a></li>
	<li id="menu-item-146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-146"><a title="Hardware" href="../../hardware/index.html">Hardware</a></li>
	<li id="menu-item-4608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4608"><a title="Robots" href="../../robots/index.html">Robots</a></li>
	<li id="menu-item-2400" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2400"><a title="About us" href="../../about-us/index.html">About us</a></li>
</ul>
</li>
<li id="menu-item-1467" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1467 dropdown"><a title="Dev Center" data-toggle="dropdown" data-hover="dropdown" href="../../dev-center/index.html">Dev Center <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-1957" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1957"><a title="Software Development" href="../../dev-center/index.html">Software Development</a></li>
	<li id="menu-item-7329" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-7329"><a title="Tutorials" href="../index.html">Tutorials</a></li>
	<li id="menu-item-1552" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1552"><a title="Operating Systems" href="../../operating-systems/index.html">Operating Systems</a></li>
	<li id="menu-item-1396" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1396"><a title="Libraries" href="../../libraries/index.html">Libraries</a></li>
	<li id="menu-item-1394" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1394"><a title="Drivers" href="../../drivers/index.html">Drivers</a></li>
	<li id="menu-item-7372" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7372"><a title="REST API documentation" href="http://api.iot-lab.info/">REST API documentation</a></li>
</ul>
</li>
<li id="menu-item-3209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3209 dropdown"><a title="Community" data-toggle="dropdown" data-hover="dropdown" href="../../community/index.html">Community <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-3244" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3244"><a title="Share your experience" href="../../community/index.html">Share your experience</a></li>
	<li id="menu-item-3210" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3210"><a title="Education" href="../../education/index.html">Education</a></li>
	<li id="menu-item-2133" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2133"><a title="Publications" href="../../publications/index.html">Publications</a></li>
	<li id="menu-item-2405" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2405"><a title="Charter" href="../../charter/index.html">Charter</a></li>
</ul>
</li>
<li id="menu-item-1470" class="get_started menu-item menu-item-type-post_type menu-item-object-page menu-item-1470"><a title="Get Started" href="../../get_started/index.html">Get Started</a></li>
</ul>

			<ul class="nav navbar-nav navbar-right">

				<li class="dropdown">
					<a href="../../testbed/drawgantt.html" title="Testbed activity"><span class="glyphicon glyphicon-calendar"></span> Activity</a>
				</li>



			                        	<li><span><a href="../../testbed/index.html" class="btn btn-primary testbed" title="Login">Access the testbed</a></span></li>
			                        </ul>
		</div>
	    </div>
	</nav>
<!-- End Top Menu -->


	<div id="page" class="container hfeed site">

				<header id="masthead" class="site-header" role="banner">
			<p id="site-title" class="site-title"><a href="../../index.html" title="FIT/IoT-LAB" rel="home">FIT/IoT-LAB</a></p><p id="site-description" class="site-description">Very large scale open wireless sensor network testbed</p>		</header><!-- #masthead -->
			<div id="content" class="site-content row">

	
	<div id="primary" class="content-area col-sm-8">

				<main id="main" class="site-main" role="main">

			<article role="article" id="post-5371" class="post-5371 page type-page status-publish hentry">
		<div class="entry-content">
		<div class="pf-content"><h2>CoAP server with public IPv6 and A8-M3 nodes</h2>
<p>&nbsp;</p>
<p><img class="alignnone size-full wp-image-1252" src="../../wp-content/uploads/2014/02/difficulty.jpg" alt="" width="30" height="30" /> <strong>Level</strong>: Medium</p>
<p><img class="size-full wp-image-1253 alignnone" src="../../wp-content/uploads/2014/02/duration.jpg" alt="" width="30" height="30" /> <strong>Duration</strong>: 45 minutes</p>
<p><em><strong>Prerequisites</strong>: <a href="../ssh-access/index.html" target="_blank">Configure SSH Access</a> / </em><em><a href="../understand-ipv6-subnetting-on-the-fit-iot-lab-testbed/index.html" target="_blank">Understand IPv6 subnetting</a></em> / <em><a href="../iotlab-experimenttools-client/index.html" target="_blank">Experiment CLI client</a></em> / <em><a title="Public IPv6 network with A8-M3 nodes" href="../riot-public-ipv6-a8-m3/index.html" target="_blank">Public IPv6 network with M3 nodes</a></p>
<p><em><strong>Description</strong>: The goal of this tutorial is to discover the basics of CoAP with RIOT on IoT-LAB. You will reserve 2 A8 nodes on the Saclay site, build and flash the required firmwares on the A8-M3 nodes, create a simple IPv6 network in IoT-LAB. Finally, from the saclay host (or any computer with a global IPv6 address), you&#8217;ll interact with the node running the CoAP server using the coap client available on the SSH frontend (or any other CoAP client).</em></p>
<div id="frontend"></div>
<ol>
<li>Connect to Saclay site host:
<pre>my_computer$ ssh &lt;login&gt;@saclay.iot-lab.info
</pre>
</li>
<li>Start an experiment called <code>riot_a8</code> that contains 2 A8 nodes.
<pre>&lt;login&gt;@saclay:~$ iotlab-auth -u &lt;login&gt; 
&lt;login&gt;@saclay:~$ iotlab-experiment submit -n riot_a8 -d 60 -l 2,archi=a8:at86rf231+site=saclay</pre>
<p>Remember the experiment identifier returned by the last command. It&#8217;ll be used<br />
in the commands shown below, <code>&lt;exp_id&gt;</code>. The requested experiment duration<br />
is 60 minutes.</li>
<li>Wait a moment until the experiment is launched (state is Running) and get the nodes list. For the next of this tutorial we suppose that we obtain <strong>a8-1.saclay.iot-lab.info</strong> and <strong>a8-2.saclay.iot-lab.info </strong>nodes.
<pre> &lt;login&gt;@saclay:~$ iotlab-experiment get -i &lt;exp_id&gt; -s
 &lt;login&gt;@saclay:~$ iotlab-experiment get -i &lt;exp_id&gt; -r</pre>
</li>
<li>Get the code of the 2019.01 release of RIOT from <a href="https://github.com/RIOT-OS/RIOT">GitHub</a>:
<pre>&lt;login&gt;@saclay:~$ mkdir -p ~/A8/riot
&lt;login&gt;@saclay:~$ cd ~/A8/riot
&lt;login&gt;@saclay:~/A8/riot$ git clone https://github.com/RIOT-OS/RIOT.git -b 2019.01-branch
&lt;login&gt;@saclay:~/A8/riot$ cd RIOT
</pre>
<p>Note that you can also use the RIOT development code (e.g the master branch) at your own risk : this tutorial may not fully work.</p>
<p><strong>Important note:</strong> to minimize radio interferences with other experiments you can build the firmwares below to make them use a different 802.15.4 channel (default is 26). To do so, add <code>DEFAULT_CHANNEL=&lt;channel&gt;</code> option to the make commands.
</li>
<li>Build the required firmware for the border router node. The node <code>node-a8-1</code> will act as the border router in this experiment. The border firmware is built using the RIOT <a href="https://github.com/RIOT-OS/RIOT/tree/master/examples/gnrc_border_router">gnrc_border_router example</a>.
<pre>&lt;login&gt;@saclay:~/A8/riot$ source /opt/riot.source
&lt;login&gt;@saclay:~/A8/riot/RIOT$ make ETHOS_BAUDRATE=500000 BOARD=iotlab-a8-m3 -C examples/gnrc_border_router clean all
&lt;login&gt;@saclay:~/A8/riot/RIOT$ cp examples/gnrc_border_router/bin/iotlab-a8-m3/gnrc_border_router.elf ~/A8/.</pre>
</li>
<li>Build the required firmware for the node running the CoAP server. RIOT <a href="https://github.com/RIOT-OS/RIOT/tree/master/examples/nanocoap_server">nanocoap_server</a> example will be used for this purpose.
<pre>&lt;login&gt;@saclay:~/A8/riot/RIOT$ make BOARD=iotlab-a8-m3 -C examples/nanocoap_server clean all
&lt;login&gt;@saclay:~/A8/riot/RIOT$ cp examples/nanocoap_server/bin/iotlab-a8-m3/nanocoap_server.elf ~/A8/.</pre>
</li>
<li>Connect to the A8 of the M3 border router: <code>node-a8-1</code>.
<pre>&lt;login&gt;@saclay:~$ ssh root@node-a8-1</pre>
<p>Then flash the BR firmware on the M3 and build the required RIOT configuration tools: uhcpd (<em>Micro Host Configuration Protocol</em>) and ethos (<em>Ethernet Over Serial</em>).</p>
<pre>root@node-a8-1:~# flash_a8_m3 A8/gnrc_border_router.elf
root@node-a8-1:~# cd ~/A8/riot/RIOT/dist/tools/uhcpd 
root@node-a8-1:~/A8/riot/RIOT/dist/tools/uhcpd# make clean all
root@node-a8-1:~/A8/riot/RIOT/dist/tools/uhcpd# cd ../ethos
root@node-a8-1:~/A8/riot/RIOT/dist/tools/ethos# make clean all</pre>
<p>On the border router, the network can finally be configured automatically using the following commands:</p>
<pre>root@node-a8-1:~/A8/riot/RIOT/dist/tools/ethos# ./start_network.sh /dev/ttyA8_M3 tap0 2001:660:3207:401::/64 500000
net.ipv6.conf.tap0.forwarding = 1
net.ipv6.conf.tap0.accept_ra = 0
----&gt; ethos: sending hello.
----&gt; ethos: activating serial pass through.
----&gt; ethos: hello reply received</pre>
<p>Note that we propagate another subnetwork for the border router (M3 node) in our LLN, <code>2001:660:3207:401::/64</code>. You can find informations about IPv6 subnetting forA8-M3 nodes <a title="Understand IPv6 Subnetting on the FIT IoT-LAB testbed" href="../understand-ipv6-subnetting-on-the-fit-iot-lab-testbed/index.html">here</a>. You can also get this subnet directly on the A8 node</p>
<pre>root@node-a8-1:~# <strong>printenv</strong>
<strong>INET6_PREFIX_LEN=64
INET6_PREFIX=2001:0660:3207:401</strong>
INET6_ADDR=2001:0660:3207:0400::1/64</pre>
</li>
<li>Now, <b>in another terminal</b>, log on the remaining A8 node, <code>node-a8-2</code>, and flash the <em>nanocoap_server</em> firmware on the M3:
<pre>my_computer$ ssh &lt;login&gt;@saclay.iot-lab.info
&lt;login&gt;@saclay:~$ ssh root@node-a8-2
root@node-a8-2:~# flash_a8_m3 A8/nanocoap_server.elf
root@node-a8-2:~# exit</pre>
</li>
<li>On the border router shell with the command <strong>nib neigh</strong> you can find the IPv6 of the node running nanocoap server. (type enter in the terminal of <strong>node-a8-1</strong> where you launched the start_network.sh script : you have access to the shell or RIOT)
<pre>&gt;
&gt; <strong>help</strong>
help
Command              Description
---------------------------------------
reboot               Reboot the node
ps                   Prints information about running threads.
ping6                Ping via ICMPv6
random_init          initializes the PRNG
random_get           returns 32 bit of pseudo randomness
nib                  Configure neighbor information base
ifconfig             Configure network interfaces
fibroute             Manipulate the FIB (info: 'fibroute [add|del]')
6ctx                 6LoWPAN context configuration toolol
&gt; <strong>nib neigh</strong>
nib neigh
[...]
<strong>2001:660:3207:401:3432:4833:46df:a902</strong> dev #6 lladdr 15:11:6B:10:46:DF:A9:02  STALE REGISTERED</pre>
</li>
<li>On the SSH frontend, you can now use the preinstalled CoAP client to query the CoAP server node. By default, the nanocoap server example of RIOT exposes only the board type to a CoAP <code>GET</code> request on <code>/riot/board</code>, let&#8217;s try it on the CoAP server node:
<pre>&lt;login&gt;@saclay:~$ aiocoap-client coap://[2001:660:3207:401:3432:4833:46df:a902]/riot/board
(2.05)	<strong>iotlab-a8-m3</strong>
</pre>
</li>
</ol>
<p>If everything works as described, you can use CoAP with RIOT on IoT-Lab. Congratulations !</p>
<p>&nbsp;</p>
</div>	</div><!-- .entry-content -->
	
</article><!-- #post-5371 -->


			
		</main><!-- #main -->
		
	</div><!-- #primary -->

	</div><!-- #content -->
	
</div><!-- #page -->

<footer class="site-footer" id="colophon" role="contentinfo">
	
	<div class="container">
		<div class="row">

			<div class="bottom-navigation col-sm-6 col-sm-push-6">
							</div><!-- .bottom-navigation -->
                </div><!-- .row -->

		<div class="row">
			<div class="footer-text col-sm-9">
				<a href="../../what-is-iot-lab/index.html">WHAT IS IOT-LAB?</a> <a href="../../about-us/index.html">ABOUT US</a> <a href="mailto:admin@iot-lab.info">CONTACT US</a> <a href="https://github.com/iot-lab/iot-lab/issues" target="_blank">SUPPORT</a> -<a href="https://github.com/iot-lab">GitHub</a>/<a href="https://twitter.com/FIT_IoTLAB">Twitter</a>/<a href="https://www.youtube.com/channel/UCrWBoYgLJCkMWgaJF8Hh3Og">Youtube</a>-   Copyright © FIT IoT-LAB			</div><!-- .footer-text -->
			<div class="col-sm-3">
				<a href="http://fit-equipex.fr/"><img class="fit-logo center-block" src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-white.svg"></a>
			</div>

		</div><!-- .row -->
	</div><!-- .container -->

	</footer><!-- #colophon -->
      <script type="text/javascript">
		
          var pfHeaderImgUrl = '';
          var pfHeaderTagline = '';
          var pfdisableClickToDel = '0';
          var pfHideImages = '0';
          var pfImageDisplayStyle = 'right';
          var pfDisableEmail = '0';
          var pfDisablePDF = '0';
          var pfDisablePrint = '0';
          var pfCustomCSS = '';
		  (function() {
            var e = document.createElement('script'); e.type="text/javascript";
		    if('https:' == document.location.protocol) {
			  js='https://pf-cdn.printfriendly.com/ssl/main.js';
		    }
		    else{
			  js='http://cdn.printfriendly.com/printfriendly.js';
		    }
            e.src = js;
            document.getElementsByTagName('head')[0].appendChild(e);
	  	  })();
      </script>
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"smooth_scroll":"1","visibility_show":"show","visibility_hide":"hide","width":"Auto"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/table-of-contents-plus/front6149.js?ver=1404'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/bootstrap.minb12b.js?ver=3.1.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/alienship-helper8a54.js?ver=1.0.0'></script>

</body>

<!-- Mirrored from www.iot-lab.info/tutorials/riot-coap-a8-m3/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:21:31 GMT -->
</html>