
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.iot-lab.info/tutorials/debugger-on-m3-nodes/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:21:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<!-- [if IE]> <meta http-equiv="X-UA-Compatible" content="IE=Edge"/> <! [endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="../../xmlrpc.php" />
<title>Debugging with M3 nodes &#8226; FIT/IoT-LAB</title>
<!--[if lt IE 9]><script src="https://www.iot-lab.info/wp-content/themes/alienship-1.2.5/js/html5shiv.js" type="text/javascript"></script><![endif]-->

<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Comments Feed" href="../../comments/feed/index.html" />
<link rel='stylesheet' id='responsive-lightbox-swipebox-front-css'  href='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/swipebox2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='toc-screen-css'  href='../../wp-content/plugins/table-of-contents-plus/screen6149.css?ver=1404' type='text/css' media='all' />
<link rel='stylesheet' id='parent-style-css'  href='../../wp-content/themes/alienship-1.2.5/style2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../../wp-content/themes/alienship-1.2.5/css/bootstrap.minb3e8.css?ver=0.1' type='text/css' media='all' />
<link rel='stylesheet' id='alienship-style-css'  href='../../wp-content/themes/alienship-1.2.5-child/styleb3e8.css?ver=0.1' type='text/css' media='all' />
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery90f9.js?ver=1.11.1'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/jquery.swipebox.min2f54.js?ver=4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var rlArgs = {"script":"swipebox","selector":"lightbox","custom_events":"","activeGalleries":"1","animation":"1","hideBars":"1","hideBarsDelay":"5000","videoMaxWidth":"1080"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/js/front2f54.js?ver=4.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5-child/js/bootstrap-hover-dropdown.min2f54.js?ver=4.1'></script>
<link rel='canonical' href='index.html' />
        <style type="text/css" media="screen">
          div.printfriendly {
            margin: 12px 12px 12px 12px;;
          }
          div.printfriendly a, div.printfriendly a:link, div.printfriendly a:visited {
            text-decoration: none;
            font-size: 14px;
            color: #6D9F00;
            vertical-align: bottom;
            border: none;
          }

          .printfriendly a:hover {
            cursor: pointer;
          }

          .printfriendly a img  {
            border: none;
            padding:0;
            margin-right: 6px;
            display:inline-block;
            box-shadow: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
          }
          .printfriendly a span{
            vertical-align: bottom;
          }
          .pf-alignleft {
            float: left;
          }
          .pf-alignright {
            float: right;
          }
          div.pf-aligncenter {
            display: block;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
          }
        </style>
        <style type="text/css" media="print">
          .printfriendly {
            display: none;
          }
        </style>
 	<style type="text/css">
 				#site-title,
		#site-description {
			position: absolute;
			clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
			clip: rect(1px, 1px, 1px, 1px);
		}
 		 	</style>
 	
<!-- BEGIN GADWP v5.3.1.1 Universal Analytics - https://deconf.com/google-analytics-dashboard-wordpress/ -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-115966924-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- END GADWP Universal Analytics -->
</head>

<body class="page page-id-4377 page-child parent-pageid-7210 page-template-default layout-1c">
	<!--[if lt IE 9]><p class="browsehappy alert alert-danger">You are using an outdated browser. Please <a class="alert-link" href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]-->

	<!-- Top Menu -->
	<nav class="navbar navbar-default navbar-onelab navbar-fixed-top top-navigation" role="navigation">
	    <div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
							<a href="../../index.html"><img src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-iotlab3.png" /></a>
					</div>

		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul id="menu-topmainmenu" class="nav navbar-nav"><li id="menu-item-2066" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2066"><a title="News" href="../../news/index.html">News</a></li>
<li id="menu-item-140" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-140 dropdown"><a title="Platform" data-toggle="dropdown" data-hover="dropdown" href="../../what-is-iot-lab/index.html">Platform <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-466" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-466"><a title="What is IoT-LAB?" href="../../what-is-iot-lab/index.html">What is IoT-LAB?</a></li>
	<li id="menu-item-147" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-147"><a title="Deployment" href="../../deployment/index.html">Deployment</a></li>
	<li id="menu-item-146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-146"><a title="Hardware" href="../../hardware/index.html">Hardware</a></li>
	<li id="menu-item-4608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4608"><a title="Robots" href="../../robots/index.html">Robots</a></li>
	<li id="menu-item-2400" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2400"><a title="About us" href="../../about-us/index.html">About us</a></li>
</ul>
</li>
<li id="menu-item-1467" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1467 dropdown"><a title="Dev Center" data-toggle="dropdown" data-hover="dropdown" href="../../dev-center/index.html">Dev Center <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-1957" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1957"><a title="Software Development" href="../../dev-center/index.html">Software Development</a></li>
	<li id="menu-item-7329" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-7329"><a title="Tutorials" href="../index.html">Tutorials</a></li>
	<li id="menu-item-1552" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1552"><a title="Operating Systems" href="../../operating-systems/index.html">Operating Systems</a></li>
	<li id="menu-item-1396" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1396"><a title="Libraries" href="../../libraries/index.html">Libraries</a></li>
	<li id="menu-item-1394" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1394"><a title="Drivers" href="../../drivers/index.html">Drivers</a></li>
	<li id="menu-item-7372" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7372"><a title="REST API documentation" href="http://api.iot-lab.info/">REST API documentation</a></li>
</ul>
</li>
<li id="menu-item-3209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3209 dropdown"><a title="Community" data-toggle="dropdown" data-hover="dropdown" href="../../community/index.html">Community <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-3244" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3244"><a title="Share your experience" href="../../community/index.html">Share your experience</a></li>
	<li id="menu-item-3210" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3210"><a title="Education" href="../../education/index.html">Education</a></li>
	<li id="menu-item-2133" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2133"><a title="Publications" href="../../publications/index.html">Publications</a></li>
	<li id="menu-item-2405" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2405"><a title="Charter" href="../../charter/index.html">Charter</a></li>
</ul>
</li>
<li id="menu-item-1470" class="get_started menu-item menu-item-type-post_type menu-item-object-page menu-item-1470"><a title="Get Started" href="../../get_started/index.html">Get Started</a></li>
</ul>

			<ul class="nav navbar-nav navbar-right">

				<li class="dropdown">
					<a href="../../testbed/drawgantt.html" title="Testbed activity"><span class="glyphicon glyphicon-calendar"></span> Activity</a>
				</li>



			                        	<li><span><a href="../../testbed/index.html" class="btn btn-primary testbed" title="Login">Access the testbed</a></span></li>
			                        </ul>
		</div>
	    </div>
	</nav>
<!-- End Top Menu -->


	<div id="page" class="container hfeed site">

				<header id="masthead" class="site-header" role="banner">
			<p id="site-title" class="site-title"><a href="../../index.html" title="FIT/IoT-LAB" rel="home">FIT/IoT-LAB</a></p><p id="site-description" class="site-description">Very large scale open wireless sensor network testbed</p>		</header><!-- #masthead -->
			<div id="content" class="site-content row">

	
	<div id="primary" class="content-area col-sm-8">

				<main id="main" class="site-main" role="main">

			<article role="article" id="post-4377" class="post-4377 page type-page status-publish hentry">
		<div class="entry-content">
		<div class="pf-content"><h2>Debugging with M3 nodes</h2>
<p>&nbsp;</p>
<p><img class="alignnone size-full wp-image-1252" src="../../wp-content/uploads/2014/02/difficulty.jpg" alt="" width="30" height="30" /> <strong>Difficulty</strong>: Medium</p>
<p><img class="alignnone size-full wp-image-1253" src="../../wp-content/uploads/2014/02/duration.jpg" alt="" width="30" height="30" /> <strong>Duration</strong>: 45 minutes</p>
<p><em><strong>Prerequisites</strong>: <a title="Configure your SSH access" href="../ssh-access/index.html" target="_blank">Configure SSH Access</a> / <a title="Submit an experiment with M3 nodes using the web portal" href="../submit-experiment-m3-web/index.html" target="_blank">Submit an experiment with M3 nodes using the web portal</a> / <a title="Get and compile a M3 Firmware code" href="../openlab-compilation/index.html" target="_blank">Get and compile a M3 firmware code</a></em></p>
<p><em><strong>Description</strong>: We use Open On-Chip Debugger (OpenOCD) on the Gateway node for programming and debugging M3 embedded target devices. OpenOCD complies with the remote gdbserver protocol and, as such, can be used to debug remote targets. </em><em>The aim of this tutorial is to learn how <em>debugging the firmware running on your experiment M3 nodes</em> with a gdb console.</em></p>
<ol>
<li>Submit a new experiment
<ul>
<li>45 minutes and starting &#8220;as soon as possible&#8221;</li>
<li>Choose your node by type
<ul>
<li>archi = m3:at86rf231</li>
<li>site = grenoble</li>
<li>number = 2</li>
</ul>
</li>
<li>Node associations: leave empty (no associations)</li>
<li>click &#8220;Submit&#8221;, then click &#8220;yes&#8221; at the warning message (&#8220;Do you really want to&#8230;&#8221;)</li>
</ul>
</li>
<li>Click on the experiment in the list and wait for the experiment to become running. Make a note of the <strong>ids</strong> (eg. m3-&lt;id&gt;) of your nodes.</li>
<li>Connect to the SSH frontend of Grenoble
<pre>ssh &lt;login&gt;@grenoble.iot-lab.info</pre>
</li>
<li>If you didn&#8217;t authenticate using <strong><tt>iotlab-auth</tt></strong>, do it now:
<pre>&lt;login&gt;@grenoble:~$ <strong>iotlab-auth -u login</strong></pre>
</li>
<li>Ensure that you have <a title="Get and compile a M3 Firmware code" href="../openlab-compilation/index.html">compiled the M3 tutorial firmware</a> and copy it in your root homedir path.
<pre>&lt;login&gt;@grenoble:~$ <strong>cp iot-lab/parts/openlab/build.m3/bin/tutorial_m3.elf .
</strong></pre>
<div class="alert alert-info">When you want to use JTAG debugging it is recommanded to desactivate power save mode and the WFI (Wait For Interrupt) processor instruction. You can comment it in openlab <a href="https://github.com/iot-lab/openlab/blob/master/platform/platform.c">platform.c</a> file (line 81) before compiling your tutorial firmware.<br />
80      // Enter SLEEP mode<br />
81     // asm volatile(&#8220;wfi&#8221;);</div>
</li>
<li>Start OpenOCD debugger mode on one of the experiment M3 node
<pre>&lt;login&gt;@grenoble:~$ <strong>iotlab-node --debug-start -l grenoble,m3,&lt;id1&gt;</strong>
{
 "0": [
 "m3-&lt;id1&gt;.grenoble.iot-lab.info"
 ]
}

</pre>
</li>
<li>Open a terminal and read node serial port
<pre>&lt;login&gt;@grenoble:~$ <strong>nc m3-&lt;id1&gt; 20000</strong></pre>
</li>
<li>Start GDB console with your binary firmare file and connect to OpenOCD which listens for GDB connections on port 3333
<pre>&lt;login&gt;@grenoble:~$<strong> arm-none-eabi-gdb -ex "target remote m3-&lt;id1&gt;:3333" tutorial_m3.elf</strong>
GNU gdb (GNU Tools for ARM Embedded Processors) 7.6.0.20140228-cvs
Copyright (C) 2013 Free Software Foundation, Inc.
...
Reading symbols from tutorial_m3.elf...done.
(gdb)</pre>
</li>
<li>Sending command to see registers list
<pre>(gdb)<strong> monitor reg</strong>
===== arm v7m registers
(0) r0 (/32)
...
</pre>
</li>
<li>Send query to see if we can find the flash module and report the proper address. It responds that it found the flash at address 0x08000000. We also check the FLASH_WRPR register at address 0x40022020 to confirm that your device&#8217;s write-protection has been disabled (0xffffffff means all pages have their write protection disable).
<pre>(gdb) <strong>monitor flash probe 0</strong>
flash 'stm32f1x' found at 0x08000000
(gdb) <strong>monitor mdw 0x40022020</strong>
0x40022020: ffffffff</pre>
</li>
<li>Perform a hard  reset
<pre>(gdb) <strong>monitor reset halt</strong></pre>
</li>
<li>Flash the firmware file
<pre>(gdb) <strong>load tutorial_m3.elf</strong></pre>
</li>
<li>Set a breakpoint in the code  with <a href="https://github.com/iot-lab/openlab/blob/master/appli/iotlab_examples/tutorial/main.c">mac_csma_data_received</a> function (main.c line 112) for stopping the code when we received a radio packet
<pre>(gdb) <strong>break mac_csma_data_received</strong></pre>
</li>
<li>List your breakpoints
<pre>(gdb) <b>info break</b></pre>
</li>
<li> Perform a hard reset with init script and continue the code execution. You must see on <strong>m3-&lt;id1&gt;</strong> serial port the print usage execution (type &#8220;Enter&#8221;)
<pre>(gdb) <strong>monitor reset init</strong>
(gdb)<strong> continue</strong></pre>
</li>
<li>Open a terminal and flash the tutoriel firmware on the <strong>m3-&lt;id2&gt;</strong> node. After read the serial port and send a radio packet
<pre>&lt;login&gt;@grenoble:~$ <strong>iotlab-node -up tutorial_m3.elf -l grenoble,m3,&lt;id2&gt;
</strong>&lt;login&gt;@grenoble:~$<strong> nc m3-&lt;id2&gt;<strong> 20000
</strong></strong>cmd &gt; s
radio &gt; Packet sent
</pre>
</li>
<li>View in gdb console your breakpoint received
<pre>Breakpoint 1, mac_csma_data_received (src_addr=39044, data=0x20000615 &lt;mac+53&gt; "Hello World!: 0", length=16 '\020', rssi=-76 '\264', lqi=lqi@entry=255 '\377')
 at /senslab/users/saintmar/iot-lab/parts/openlab/appli/iotlab_examples/tutorial/main.c:112
112 {</pre>
</li>
<li>Print ten lines main.c source code file and continue execution
<pre>(gdb) <strong>list</strong>
107	
108	
109	/* Reception of a radio message */
110	void mac_csma_data_received(uint16_t src_addr,
111	        const uint8_t *data, uint8_t length, int8_t rssi, uint8_t lqi)
112	{
113	    // disable help message after receiving one packet
114	    print_help = 0;
115	
116	    printf("\nradio &gt; ");
(gdb) <strong>continue
</strong></pre>
</li>
<li>View on <strong>m3-&lt;id1&gt;</strong> serial port the packet received
<pre> cmd &gt; 
radio &gt; Got packet from 9884. Len: 16 Rssi: -76: 'Hello World!: 0'
</pre>
</li>
</ol>
</div>	</div><!-- .entry-content -->
	
</article><!-- #post-4377 -->


			
		</main><!-- #main -->
		
	</div><!-- #primary -->

	</div><!-- #content -->
	
</div><!-- #page -->

<footer class="site-footer" id="colophon" role="contentinfo">
	
	<div class="container">
		<div class="row">

			<div class="bottom-navigation col-sm-6 col-sm-push-6">
							</div><!-- .bottom-navigation -->
                </div><!-- .row -->

		<div class="row">
			<div class="footer-text col-sm-9">
				<a href="../../what-is-iot-lab/index.html">WHAT IS IOT-LAB?</a> <a href="../../about-us/index.html">ABOUT US</a> <a href="mailto:admin@iot-lab.info">CONTACT US</a> <a href="https://github.com/iot-lab/iot-lab/issues" target="_blank">SUPPORT</a> -<a href="https://github.com/iot-lab">GitHub</a>/<a href="https://twitter.com/FIT_IoTLAB">Twitter</a>/<a href="https://www.youtube.com/channel/UCrWBoYgLJCkMWgaJF8Hh3Og">Youtube</a>-   Copyright © FIT IoT-LAB			</div><!-- .footer-text -->
			<div class="col-sm-3">
				<a href="http://fit-equipex.fr/"><img class="fit-logo center-block" src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-white.svg"></a>
			</div>

		</div><!-- .row -->
	</div><!-- .container -->

	</footer><!-- #colophon -->
      <script type="text/javascript">
		
          var pfHeaderImgUrl = '';
          var pfHeaderTagline = '';
          var pfdisableClickToDel = '0';
          var pfHideImages = '0';
          var pfImageDisplayStyle = 'right';
          var pfDisableEmail = '0';
          var pfDisablePDF = '0';
          var pfDisablePrint = '0';
          var pfCustomCSS = '';
		  (function() {
            var e = document.createElement('script'); e.type="text/javascript";
		    if('https:' == document.location.protocol) {
			  js='https://pf-cdn.printfriendly.com/ssl/main.js';
		    }
		    else{
			  js='http://cdn.printfriendly.com/printfriendly.js';
		    }
            e.src = js;
            document.getElementsByTagName('head')[0].appendChild(e);
	  	  })();
      </script>
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"smooth_scroll":"1","visibility_show":"show","visibility_hide":"hide","width":"Auto"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/table-of-contents-plus/front6149.js?ver=1404'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/bootstrap.minb12b.js?ver=3.1.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/alienship-helper8a54.js?ver=1.0.0'></script>

</body>

<!-- Mirrored from www.iot-lab.info/tutorials/debugger-on-m3-nodes/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:21:35 GMT -->
</html>