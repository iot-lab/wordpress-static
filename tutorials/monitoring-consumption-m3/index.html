
<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.iot-lab.info/tutorials/monitoring-consumption-m3/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:20:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<!-- [if IE]> <meta http-equiv="X-UA-Compatible" content="IE=Edge"/> <! [endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="../../xmlrpc.php" />
<title>Monitor the consumption of an M3 node during an experiment &#8226; FIT/IoT-LAB</title>
<!--[if lt IE 9]><script src="https://www.iot-lab.info/wp-content/themes/alienship-1.2.5/js/html5shiv.js" type="text/javascript"></script><![endif]-->

<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="FIT/IoT-LAB &raquo; Comments Feed" href="../../comments/feed/index.html" />
<link rel='stylesheet' id='responsive-lightbox-swipebox-front-css'  href='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/swipebox2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='toc-screen-css'  href='../../wp-content/plugins/table-of-contents-plus/screen6149.css?ver=1404' type='text/css' media='all' />
<link rel='stylesheet' id='parent-style-css'  href='../../wp-content/themes/alienship-1.2.5/style2f54.css?ver=4.1' type='text/css' media='all' />
<link rel='stylesheet' id='bootstrap-css'  href='../../wp-content/themes/alienship-1.2.5/css/bootstrap.minb3e8.css?ver=0.1' type='text/css' media='all' />
<link rel='stylesheet' id='alienship-style-css'  href='../../wp-content/themes/alienship-1.2.5-child/styleb3e8.css?ver=0.1' type='text/css' media='all' />
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery90f9.js?ver=1.11.1'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min1576.js?ver=1.2.1'></script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/assets/swipebox/source/jquery.swipebox.min2f54.js?ver=4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var rlArgs = {"script":"swipebox","selector":"lightbox","custom_events":"","activeGalleries":"1","animation":"1","hideBars":"1","hideBarsDelay":"5000","videoMaxWidth":"1080"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/responsive-lightbox/js/front2f54.js?ver=4.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5-child/js/bootstrap-hover-dropdown.min2f54.js?ver=4.1'></script>
<link rel='canonical' href='index.html' />
        <style type="text/css" media="screen">
          div.printfriendly {
            margin: 12px 12px 12px 12px;;
          }
          div.printfriendly a, div.printfriendly a:link, div.printfriendly a:visited {
            text-decoration: none;
            font-size: 14px;
            color: #6D9F00;
            vertical-align: bottom;
            border: none;
          }

          .printfriendly a:hover {
            cursor: pointer;
          }

          .printfriendly a img  {
            border: none;
            padding:0;
            margin-right: 6px;
            display:inline-block;
            box-shadow: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
          }
          .printfriendly a span{
            vertical-align: bottom;
          }
          .pf-alignleft {
            float: left;
          }
          .pf-alignright {
            float: right;
          }
          div.pf-aligncenter {
            display: block;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
          }
        </style>
        <style type="text/css" media="print">
          .printfriendly {
            display: none;
          }
        </style>
 	<style type="text/css">
 				#site-title,
		#site-description {
			position: absolute;
			clip: rect(1px 1px 1px 1px); /* IE6, IE7 */
			clip: rect(1px, 1px, 1px, 1px);
		}
 		 	</style>
 	
<!-- BEGIN GADWP v5.3.1.1 Universal Analytics - https://deconf.com/google-analytics-dashboard-wordpress/ -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-115966924-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- END GADWP Universal Analytics -->
</head>

<body class="page page-id-6742 page-child parent-pageid-7210 page-template-default layout-1c">
	<!--[if lt IE 9]><p class="browsehappy alert alert-danger">You are using an outdated browser. Please <a class="alert-link" href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p><![endif]-->

	<!-- Top Menu -->
	<nav class="navbar navbar-default navbar-onelab navbar-fixed-top top-navigation" role="navigation">
	    <div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
							<a href="../../index.html"><img src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-iotlab3.png" /></a>
					</div>

		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul id="menu-topmainmenu" class="nav navbar-nav"><li id="menu-item-2066" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2066"><a title="News" href="../../news/index.html">News</a></li>
<li id="menu-item-140" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-140 dropdown"><a title="Platform" data-toggle="dropdown" data-hover="dropdown" href="../../what-is-iot-lab/index.html">Platform <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-466" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-466"><a title="What is IoT-LAB?" href="../../what-is-iot-lab/index.html">What is IoT-LAB?</a></li>
	<li id="menu-item-147" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-147"><a title="Deployment" href="../../deployment/index.html">Deployment</a></li>
	<li id="menu-item-146" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-146"><a title="Hardware" href="../../hardware/index.html">Hardware</a></li>
	<li id="menu-item-4608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4608"><a title="Robots" href="../../robots/index.html">Robots</a></li>
	<li id="menu-item-2400" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2400"><a title="About us" href="../../about-us/index.html">About us</a></li>
</ul>
</li>
<li id="menu-item-1467" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-1467 dropdown"><a title="Dev Center" data-toggle="dropdown" data-hover="dropdown" href="../../dev-center/index.html">Dev Center <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-1957" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1957"><a title="Software Development" href="../../dev-center/index.html">Software Development</a></li>
	<li id="menu-item-7329" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor menu-item-7329"><a title="Tutorials" href="../index.html">Tutorials</a></li>
	<li id="menu-item-1552" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1552"><a title="Operating Systems" href="../../operating-systems/index.html">Operating Systems</a></li>
	<li id="menu-item-1396" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1396"><a title="Libraries" href="../../libraries/index.html">Libraries</a></li>
	<li id="menu-item-1394" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1394"><a title="Drivers" href="../../drivers/index.html">Drivers</a></li>
	<li id="menu-item-7372" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7372"><a title="REST API documentation" href="http://api.iot-lab.info/">REST API documentation</a></li>
</ul>
</li>
<li id="menu-item-3209" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-3209 dropdown"><a title="Community" data-toggle="dropdown" data-hover="dropdown" href="../../community/index.html">Community <span class="caret"></span></a>
<ul role="menu" class=" dropdown-menu">
	<li id="menu-item-3244" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3244"><a title="Share your experience" href="../../community/index.html">Share your experience</a></li>
	<li id="menu-item-3210" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3210"><a title="Education" href="../../education/index.html">Education</a></li>
	<li id="menu-item-2133" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2133"><a title="Publications" href="../../publications/index.html">Publications</a></li>
	<li id="menu-item-2405" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2405"><a title="Charter" href="../../charter/index.html">Charter</a></li>
</ul>
</li>
<li id="menu-item-1470" class="get_started menu-item menu-item-type-post_type menu-item-object-page menu-item-1470"><a title="Get Started" href="../../get_started/index.html">Get Started</a></li>
</ul>

			<ul class="nav navbar-nav navbar-right">

				<li class="dropdown">
					<a href="../../testbed/drawgantt.html" title="Testbed activity"><span class="glyphicon glyphicon-calendar"></span> Activity</a>
				</li>



			                        	<li><span><a href="../../testbed/index.html" class="btn btn-primary testbed" title="Login">Access the testbed</a></span></li>
			                        </ul>
		</div>
	    </div>
	</nav>
<!-- End Top Menu -->


	<div id="page" class="container hfeed site">

				<header id="masthead" class="site-header" role="banner">
			<p id="site-title" class="site-title"><a href="../../index.html" title="FIT/IoT-LAB" rel="home">FIT/IoT-LAB</a></p><p id="site-description" class="site-description">Very large scale open wireless sensor network testbed</p>		</header><!-- #masthead -->
			<div id="content" class="site-content row">

	
	<div id="primary" class="content-area col-sm-8">

				<main id="main" class="site-main" role="main">

			<article role="article" id="post-6742" class="post-6742 page type-page status-publish hentry">
		<div class="entry-content">
		<div class="pf-content"><h2>Monitor the consumption of M3 node during an experiment</h2>
<p>&nbsp;</p>
<p><img class="alignnone size-full wp-image-1252" src="../../wp-content/uploads/2014/02/difficulty.jpg" alt="" width="30" height="30" /> <strong>Difficulty</strong>: Medium</p>
<p><img class="alignnone size-full wp-image-1253" src="../../wp-content/uploads/2014/02/duration.jpg" alt="" width="30" height="30" /> <strong>Duration</strong>: 20 minutes</p>
<p><em><strong>Prerequisites</strong>: <a title="Configure your SSH access" href="../ssh-access/index.html" target="_blank">Configure SSH Access</a> / <a title="Submit an experiment with M3 nodes using the web portal" href="../submit-experiment-m3-web/index.html" target="_blank">Submit an experiment with M3 nodes using the web portal</a></em></p>
<p><em><strong>Description</strong>: Each node of an experiment is managed by its Control Node (users have no access to it), that interacts passively or actively. It monitors node consumption, power radio signal (RSSI) and selects power supply (battery or DC through POE). </em><em>A Profile represents the Control Node configuration during the experiment. The aim of this tutorial is to create a profile for monitoring consumption and launch an experiment with a firmware that turns on/off red, blue and green LEDs (1Hz period)</em></p>
<ol>
<ol>
<li><a href="../../testbed/index.html" target="_blank">Log into the Webportal</a></li>
<li>Select the <strong>Resources / Monitoring profiles</strong> tab</li>
<li>Click the <strong>New profile</strong> button to create a new profile</li>
<li>Set a profile <strong>Name</strong>, the M3 <strong>Node architecture</strong>, and all the <strong>Consumption</strong> checkboxes (<strong>current, voltage, p<strong>ower</strong></strong>) with:
<ul>
<li><strong>Period</strong> = 8244 µs</li>
<li><strong>Average</strong> = 4</li>
</ul>
</li>
<li>Save this profile.</li>
<li>This setting will give you a sampling period of <span style="line-height: 1.428571429;">P = 8.244 ms * 4 * 2 = 65.95 ms</span> (see below for <a href="#time">more informations about the sampling period</a>).
<p style="text-align: cednter;"><a href="../../wp-content/uploads/2014/04/monitoring-conso2.png" rel="lightbox[gallery-OJPo]"><img class="alignnone  wp-image-6042 image-shadow" src="../../wp-content/uploads/2014/04/monitoring-conso2.png" alt="profile" width="566" height="429" /></a></p>
</li>
<li>Submit a new experiment
<ul>
<li>Duration : <strong>10 minutes</strong> and select “<strong>As soon as possible</strong>”</li>
<li>Choose one node:
<ul>
<li>Select nodes “<strong>by node properties</strong>”</li>
<li>Select Archi = M3 (at86rf231) / Site = Grenoble / Quantity = 1 / Mobile = no</li>
<li>Click “<strong>Add to experiment</strong>”</li>
</ul>
</li>
<li>Firmware association: use this <a href="https://raw.githubusercontent.com/wiki/iot-lab/iot-lab/firmwares/tutorial_m3.elf">tutorial binary firmware file</a>. (click button <strong>Add Firmware</strong> (microship icon next to the node))</li>
<li>Monitoring profile association: use the profile you have created earlier. (click button <strong>Add monitoring</strong> (thermometer icon))</li>
</ul>
<p style="text-align: center;"><a href="../../wp-content/uploads/2014/04/submit-experiment-monitoring-conso1.html" rel="lightbox[gallery-OJPo]"><img class="aligncenter wp-image-3739 image-shadow" src="../../wp-content/uploads/2018/03/submit-experiment-monitoring-conso1.png" alt="association-profile" width="800" /></a></p>
</li>
<li>Click on the experiment in the list, and make a note of the node id, while you wait for the experiment to become running.</li>
<li>Connect to the SSH fronted of Grenoble with <strong>X11Forwarding</strong>
<pre>ssh <strong>-X</strong> &lt;login&gt;@grenoble.iot-lab.info</pre>
</li>
<li>The consumption measure values are stored in your home folder in .oml files. As we use caching mechanism, you must wait that you have content in the file.
<pre>&lt;login&gt;@grenoble:~$ <strong>less ~/.iot-lab/&lt;experiment id&gt;/consumption/m3-&lt;id&gt;.oml</strong>
protocol: 4
domain: 1621
start-time: 1379945917
sender-id: m3-3
app-name: control_node_measures
schema: 0 _experiment_metadata subject:string key:string value:string 
schema: 1 control_node_measures_consumption timestamp_s:uint64 timestamp_us:uint32 power:double voltage:double current:double 
content: text

1.341009        1       1       1379945918      303436  0.053461        3.272500        0.016347
1.341392        1       2       1379945918      307892  0.053232        3.273750        0.016270
1.341448        1       3       1379945918      312317  0.053384        3.272500        0.016322</pre>
<p>See the <a href="#profile">profile measure table</a> below for more informations.</li>
<li>Plot your file using the oml_plot.py script file
<pre>&lt;login&gt;@grenoble:~$ <strong>plot_oml_consum -p -i ~/.iot-lab/&lt;experiment id&gt;/consumption/m3-&lt;id&gt;.oml</strong></pre>
<p>You may observe oscillations corresponding to the 1Hz LED(s) blinking. It is also possible to measure the current on each LED which is theoretically equal to 2.4 mA.</li>
</ol>
</ol>
<div class="row">
<div class="col-sm-4 col-sm-offset-2">
<div class="thumbnail"><a href="../../wp-content/uploads/2014/04/full-plot.jpg" rel="lightbox[gallery-OJPo]"><img class="aligncenter  wp-image-3747" src="../../wp-content/uploads/2014/04/full-plot.jpg" alt="full-plot" width="432" height="307" /></a></p>
<div class="caption text-center"><em>Full plot graph from the node starting</em></div>
</div>
</div>
<div class="col-sm-4">
<div class="thumbnail"><a href="../../wp-content/uploads/2014/04/zoom-plot.jpg" rel="lightbox[gallery-OJPo]"><img class="aligncenter  wp-image-3749" src="../../wp-content/uploads/2014/04/zoom-plot.jpg" alt="zoom-plot" width="432" height="307" /></a></p>
<div class="caption text-center"><em>Zoom on plot to verify the 1 second period</em></div>
</div>
</div>
</div>
<ol>
<ol>
<li>Repeat the operations 3. to 7. to measure the LED consumption, changing the monitoring sample period parameters given in 4. By choosing a smaller sample period (Period = 1100 µs = 1.100 ms ; Average = 1 ; Sample Period = 1.100 * 1 * 2 = 2.200 ms), you will observe that the signal measure noise is not filtered (see figure below).</li>
</ol>
</ol>
<div class="row">
<div class="col-sm-4 col-sm-offset-4">
<div class="thumbnail"><a href="../../wp-content/uploads/2014/04/plot_power31.png" rel="lightbox[gallery-OJPo]"><img class="aligncenter  wp-image-2738" src="../../wp-content/uploads/2014/04/plot_power31-1024x545.png" alt="plot_power3" width="469" height="249" /></a></p>
<div class="caption text-center"><em>Full plot graph with a smaller sample period</em></div>
</div>
</div>
</div>
<p>&nbsp;<br />
&nbsp;<br />
&nbsp;</p>
<div class="alert alert-info">
<h3>Additional details</h3>
<p><a name="time"></a></p>
<h4>Averaging and Conversion Time Considerations</h4>
<p>The M3 node is connected on a gateway which measures its consumption through resistor shunts and an INA226 current/power monitor component.</p>
<p>The INA226 has programmable conversion times for both the shunt voltage and bus voltage measurements. The conversion times (CT) for these measurements can be selected from as fast as 140μs to as long as 8.244ms. The conversion time settings, along with the programmable averaging mode (AV), allow the INA226 to be configured to optimize the available timing requirements in a given application. The periodic measure (PM) is then given by the formula:<br />
PM = CT * AV * 2.</p>
<p>There are trade-offs associated with the settings for conversion time and the averaging mode used. The averaging feature can significantly improve the measurement accuracy by effectively filtering the signal. A greater number of averages enables the INA226 to be more effective in reducing the noise component of the measurement.</p>
<p>For example, if a system requires that data be read every 4ms, the INA226 could be configured for a non filtered signal with the conversion times set to 2116 μs and the averaging mode set to 1. This configuration results in the data updating approximately every<br />
4.23 ms = 2.116 * 1 * 2.</p>
<p>With a configuration for a filtered signal, the conversion times can be set to 204 μs and the averaging mode can be set to 10 in order to have a periodic measure of<br />
4.08 ms = 204 * 10 * 2</p>
<p><a name="profile"></a></p>
<h4>Profile measure table</h4>
<table class="table table-striped">
<thead>
<tr>
<th>M3 node</th>
<th>Measure</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr>
<td><b>Consumption</b></td>
<td>current<br />
voltage<br />
power</td>
<td>ampere<br />
volt<br />
watt</td>
</tr>
<tr>
<td><b>Radio</b></td>
<td>RSSI</td>
<td>dBm</td>
</tr>
</tbody>
</table>
</div>
</div>	</div><!-- .entry-content -->
	
</article><!-- #post-6742 -->


			
		</main><!-- #main -->
		
	</div><!-- #primary -->

	</div><!-- #content -->
	
</div><!-- #page -->

<footer class="site-footer" id="colophon" role="contentinfo">
	
	<div class="container">
		<div class="row">

			<div class="bottom-navigation col-sm-6 col-sm-push-6">
							</div><!-- .bottom-navigation -->
                </div><!-- .row -->

		<div class="row">
			<div class="footer-text col-sm-9">
				<a href="../../what-is-iot-lab/index.html">WHAT IS IOT-LAB?</a> <a href="../../about-us/index.html">ABOUT US</a> <a href="mailto:admin@iot-lab.info">CONTACT US</a> <a href="https://github.com/iot-lab/iot-lab/issues" target="_blank">SUPPORT</a> -<a href="https://github.com/iot-lab">GitHub</a>/<a href="https://twitter.com/FIT_IoTLAB">Twitter</a>/<a href="https://www.youtube.com/channel/UCrWBoYgLJCkMWgaJF8Hh3Og">Youtube</a>-   Copyright © FIT IoT-LAB			</div><!-- .footer-text -->
			<div class="col-sm-3">
				<a href="http://fit-equipex.fr/"><img class="fit-logo center-block" src="../../wp-content/themes/alienship-1.2.5-child/templates/parts/fit-white.svg"></a>
			</div>

		</div><!-- .row -->
	</div><!-- .container -->

	</footer><!-- #colophon -->
      <script type="text/javascript">
		
          var pfHeaderImgUrl = '';
          var pfHeaderTagline = '';
          var pfdisableClickToDel = '0';
          var pfHideImages = '0';
          var pfImageDisplayStyle = 'right';
          var pfDisableEmail = '0';
          var pfDisablePDF = '0';
          var pfDisablePrint = '0';
          var pfCustomCSS = '';
		  (function() {
            var e = document.createElement('script'); e.type="text/javascript";
		    if('https:' == document.location.protocol) {
			  js='https://pf-cdn.printfriendly.com/ssl/main.js';
		    }
		    else{
			  js='http://cdn.printfriendly.com/printfriendly.js';
		    }
            e.src = js;
            document.getElementsByTagName('head')[0].appendChild(e);
	  	  })();
      </script>
<script type='text/javascript'>
/* <![CDATA[ */
var tocplus = {"smooth_scroll":"1","visibility_show":"show","visibility_hide":"hide","width":"Auto"};
/* ]]> */
</script>
<script type='text/javascript' src='../../wp-content/plugins/table-of-contents-plus/front6149.js?ver=1404'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/bootstrap.minb12b.js?ver=3.1.1'></script>
<script type='text/javascript' src='../../wp-content/themes/alienship-1.2.5/js/alienship-helper8a54.js?ver=1.0.0'></script>

</body>

<!-- Mirrored from www.iot-lab.info/tutorials/monitoring-consumption-m3/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 05 Jun 2020 08:21:05 GMT -->
</html>